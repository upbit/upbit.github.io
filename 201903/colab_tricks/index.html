<!doctype html><html lang=zh-cn><head><title>Google Colab中一些你可能不知道的tricks // 夢沉抹大拉</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.104.3"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Zhou Hao"><meta name=description content="Tricks you may not known in Google Colab"><link rel=stylesheet href=https://blog.imaou.com/css/main.min.0fb49e70a30412f97ddfc418e18fefef1d9fcdebe45f634dbbba768b00fe1eec.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Google Colab中一些你可能不知道的tricks"><meta name=twitter:description content="Tricks you may not known in Google Colab"><meta property="og:title" content="Google Colab中一些你可能不知道的tricks"><meta property="og:description" content="Tricks you may not known in Google Colab"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.imaou.com/201903/colab_tricks/"><meta property="article:section" content="post"><meta property="article:published_time" content="2019-03-03T20:00:00+08:00"><meta property="article:modified_time" content="2019-03-03T20:00:00+08:00"></head><body><header class=app-header><a href=https://blog.imaou.com><img class=app-header-avatar src=/avatar.jpg alt="Zhou Hao"></a>
<span class=app-header-title>夢沉抹大拉</span><nav class=app-header-menu><a class=app-header-menu-item href=/>Blog</a>
/
<a class=app-header-menu-item href=/page/about/>About</a></nav><p>一个追寻抹大拉之地的geeker</p><div class=app-header-social><a href=https://github.com/upbit target=_blank rel="noreferrer noopener me"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>GitHub</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a href=https://upbit.artstation.com/ target=_blank rel="noreferrer noopener me"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-aperture"><title>ArtStation</title><circle cx="12" cy="12" r="10"/><line x1="14.31" y1="8" x2="20.05" y2="17.94"/><line x1="9.69" y1="8" x2="21.17" y2="8"/><line x1="7.38" y1="12" x2="13.12" y2="2.06"/><line x1="9.69" y1="16" x2="3.95" y2="6.06"/><line x1="14.31" y1="16" x2="2.83" y2="16"/><line x1="16.62" y1="12" x2="10.88" y2="21.94"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Google Colab中一些你可能不知道的tricks</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Mar 3, 2019</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>1 min read</div></div></header><div class=post-content><blockquote><p>几年后重新开始写技术blog。一直把colab当备忘录，直到最近有人问起来BERT的各种问题，而我自己又有点记不清了(看完的代码过个年就忘干净&mldr;捂脸)
既然用了colab这么久，第一篇就帮colab打打广告吧 :stuck_out_tongue_closed_eyes:</p></blockquote><h1 id=google-colabhttpscolabresearchgooglecom><a href=https://colab.research.google.com>Google Colab</a></h1><p>Colab是一个Google提供的免费Jupyter笔记本环境，完全保存于云端，并且有免费的GPU/TPU可以使用：</p><p><a href=https://colab.research.google.com/notebooks/welcome.ipynb>https://colab.research.google.com/notebooks/welcome.ipynb</a></p><h2 id=1-用代码清空单元格输出-clear_output>1. 用代码清空单元格输出 <code>clear_output()</code></h2><p>在BERT教程里看到的方法。有时想看迭代进度，但最后又不想滑动很久看eval的效果输出，就可以在train完成后加上<code>clear_output()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>from</span> IPython.display <span style=color:#f92672>import</span> clear_output
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 这里输出很多内容，比如训练modle</span>
</span></span><span style=display:flex><span>clear_output() <span style=color:#75715e># 执行后之前的输出将被清空</span>
</span></span></code></pre></div><h2 id=2-访问-google-drive-上的数据>2. 访问 Google Drive 上的数据</h2><p>colab的数据不是永久存储的，一些训练好的model或者私有数据，往往需要存储到gdrive上：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>from</span> google.colab <span style=color:#f92672>import</span> drive
</span></span><span style=display:flex><span>drive<span style=color:#f92672>.</span>mount(<span style=color:#e6db74>&#39;/content/gdrive&#39;</span>)
</span></span><span style=display:flex><span>GDRIVE_ROOT <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/content/gdrive/My Drive&#34;</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>!</span>ls <span style=color:#e6db74>&#34;$GDRIVE_ROOT/datasets&#34;</span>
</span></span></code></pre></div><p>执行后会输出个认证url和输入框，点击url后复制里面的key，粘贴在输入框里回车即可。</p><p>之后的<code>!ls</code>语法，感叹号和jupyter里一样，代表执行shell，python的变量可以类似上面的<code>$GDRIVE_ROOT</code>来访问</p><h2 id=3-eager-execution>3. Eager Execution</h2><p>这个估计大部分同学都知道。colab类似anaconda默认安装了很多基础库。当然如果缺少，还是可以通过<code>!pip</code>来安装和升级的</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>import</span> tensorflow <span style=color:#66d9ef>as</span> tf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tf<span style=color:#f92672>.</span>enable_eager_execution()
</span></span></code></pre></div><h2 id=4-cell的标题和参数控制>4. Cell的标题和参数控制</h2><p>注释后加<code>@title</code>且放在顶行，右侧会出现对应的标题内容。而某个变量赋值后，加上<code>@param</code>则可以提供输入选项：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#75715e>#@title 演示如何提供参数控制</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>LOG_DIR <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/tmp/model&#39;</span> <span style=color:#75715e>#@param {type:&#34;string&#34;}</span>
</span></span><span style=display:flex><span>text_and_dropdown <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;faces&#39;</span> <span style=color:#75715e>#@param [&#34;faces&#34;, &#34;celebs&#34;, &#34;cats&#34;, &#34;cars&#34;, &#34;bedrooms&#34;, &#34;anime&#34;]</span>
</span></span><span style=display:flex><span>seed <span style=color:#f92672>=</span> <span style=color:#ae81ff>123456</span> <span style=color:#75715e>#@param {type:&#34;slider&#34;, min: 0, max: 10000000, step: 1}</span>
</span></span></code></pre></div><h2 id=5-tensorboard>5. Tensorboard</h2><p>使用ngork可以开启tensorboard。如果logdir变更了，重新执行这段代码获取新地址即可：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#75715e># @title Tensorboard</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>!</span>ps aux <span style=color:#f92672>|</span> grep tensorboard <span style=color:#f92672>|</span> awk <span style=color:#e6db74>&#39;{print $2}&#39;</span> <span style=color:#f92672>|</span> xargs kill <span style=color:#f92672>-</span><span style=color:#ae81ff>9</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>!</span>ps aux <span style=color:#f92672>|</span> grep ngrok <span style=color:#f92672>|</span> awk <span style=color:#e6db74>&#39;{print $2}&#39;</span> <span style=color:#f92672>|</span> xargs kill <span style=color:#f92672>-</span><span style=color:#ae81ff>9</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>!</span>test <span style=color:#f92672>-</span>f ngrok<span style=color:#f92672>-</span>stable<span style=color:#f92672>-</span>linux<span style=color:#f92672>-</span>amd64<span style=color:#f92672>.</span>zip <span style=color:#f92672>||</span> wget https:<span style=color:#f92672>//</span>bin<span style=color:#f92672>.</span>equinox<span style=color:#f92672>.</span>io<span style=color:#f92672>/</span>c<span style=color:#f92672>/</span><span style=color:#ae81ff>4</span>VmDzA7iaHb<span style=color:#f92672>/</span>ngrok<span style=color:#f92672>-</span>stable<span style=color:#f92672>-</span>linux<span style=color:#f92672>-</span>amd64<span style=color:#f92672>.</span>zip
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>!</span>test <span style=color:#f92672>-</span>f ngrok <span style=color:#f92672>||</span> unzip ngrok<span style=color:#f92672>-</span>stable<span style=color:#f92672>-</span>linux<span style=color:#f92672>-</span>amd64<span style=color:#f92672>.</span>zip
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>LOG_DIR <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;/tmp/model-wide_n_deep&#39;</span> <span style=color:#75715e>#@param {type:&#34;string&#34;}</span>
</span></span><span style=display:flex><span>get_ipython()<span style=color:#f92672>.</span>system_raw(
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;tensorboard --logdir </span><span style=color:#e6db74>{}</span><span style=color:#e6db74> --host 0.0.0.0 --port 6006 &amp;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>format(LOG_DIR)
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get_ipython()<span style=color:#f92672>.</span>system_raw(<span style=color:#e6db74>&#39;./ngrok http 6006 &amp;&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>!</span> curl <span style=color:#f92672>-</span>s http:<span style=color:#f92672>//</span>localhost:<span style=color:#ae81ff>4040</span><span style=color:#f92672>/</span>api<span style=color:#f92672>/</span>tunnels <span style=color:#f92672>|</span> python3 <span style=color:#f92672>-</span>c \
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;import sys, json; print(json.load(sys.stdin)[&#39;tunnels&#39;][0][&#39;public_url&#39;])&#34;</span>
</span></span></code></pre></div><h2 id=6-修改某个pypi库的源码>6. 修改某个pypi库的源码</h2><p>有些情况下不想使用pip的版本，但又不想自己重新打包whl，可以试下<code>pip --editable</code>这种安装方式。</p><p>例如下面这段，每次都安装<code>pytorch-pretrained-BERT</code>的master代码，然后就可以尽情修改或者覆盖代码文件了</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>!</span>test <span style=color:#f92672>-</span>d pytorch<span style=color:#f92672>-</span>pretrained<span style=color:#f92672>-</span>BERT <span style=color:#f92672>||</span> git clone https:<span style=color:#f92672>//</span>github<span style=color:#f92672>.</span>com<span style=color:#f92672>/</span>huggingface<span style=color:#f92672>/</span>pytorch<span style=color:#f92672>-</span>pretrained<span style=color:#f92672>-</span>BERT<span style=color:#f92672>.</span>git pytorch<span style=color:#f92672>-</span>pretrained<span style=color:#f92672>-</span>BERT
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> <span style=color:#e6db74>&#39;pytorch-pretrained-BERT&#39;</span> <span style=color:#f92672>in</span> sys<span style=color:#f92672>.</span>path:
</span></span><span style=display:flex><span>    sys<span style=color:#f92672>.</span>path <span style=color:#f92672>+=</span> [<span style=color:#e6db74>&#39;pytorch-pretrained-BERT&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>!</span>cd pytorch<span style=color:#f92672>-</span>pretrained<span style=color:#f92672>-</span>BERT <span style=color:#f92672>&amp;&amp;</span> pip install <span style=color:#f92672>-</span>q <span style=color:#f92672>--</span>editable <span style=color:#f92672>.</span>
</span></span></code></pre></div></div><div class=post-footer></div></article></main></body></html>